<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PHP Delete Generator with Header Auth</title>
<style>
body{font-family:Arial,sans-serif;background:#fff;margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;gap:15px}
.container{background:#fff;padding:18px;border-radius:10px;width:90%;max-width:500px;box-shadow:0 1px 4px rgba(0,0,0,0.1)}
h2{text-align:center;margin-bottom:12px;color:#333}
label{font-weight:bold;margin:6px 0 4px;display:block;color:#444}
input,textarea,button,select{width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;font-size:15px;margin-bottom:10px;box-sizing:border-box}
input:focus,textarea:focus,select:focus{outline:none;border-color:#007bff;box-shadow:0 0 3px rgba(0,123,255,0.2)}
button{background:#007bff;border:none;color:#fff;font-weight:bold;cursor:pointer;transition:0.3s}
button:hover{background:#0056b3}
textarea{resize:none;height:220px;font-family:monospace;font-size:14px;background:#f9f9f9}
#toast{display:none;min-width:200px;background:#28a745;color:#fff;text-align:center;border-radius:8px;padding:12px;position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:9999;opacity:.95;font-weight:bold}
</style>
</head>
<body>

<div class="container">
<h2>Access Config</h2>
<label>Admin Table Name</label>
<input type="text" id="adminTable" placeholder="e.g. admin">

<label>Token Column Name</label>
<input type="text" id="adminColumn" placeholder="e.g. token">

<label>Auth Failed Message</label>
<input type="text" id="authFailedMsg" placeholder="e.g. Auth Failed">
</div>

<div class="container">
<h2>Delete Config</h2>
<label>Table Name</label>
<input type="text" id="table" placeholder="Enter Table Name">

<label>Primary Key Column</label>
<input type="text" id="pk" placeholder="e.g. id">

<label>Success Message</label>
<input type="text" id="sres" placeholder="e.g. Deleted Successfully">

<label>Failed Message</label>
<input type="text" id="fres" placeholder="e.g. Delete Failed">

<label>Mode</label>
<select id="mode">
  <option value="debug">Debug (Show DB error)</option>
  <option value="secure">Secure (Hide DB error)</option>
</select>
</div>

<div class="container">
<button onclick="generateCode()">Generate PHP</button>
<textarea id="output" readonly placeholder="Generated PHP code will appear here..."></textarea>
<button onclick="copyCode()">Copy Code</button>
</div>

<div id="toast"></div>

<script>
function showToast(msg,color="#28a745"){
  const t=document.getElementById('toast');
  t.style.background=color;
  t.innerText=msg;
  t.style.display='block';
  setTimeout(()=>t.style.display='none',3000);
}

function generateCode(){
  const adminTable=document.getElementById("adminTable").value.trim();
  const adminColumn=document.getElementById("adminColumn").value.trim();
  const authFailed=document.getElementById("authFailedMsg").value.trim();
  const table=document.getElementById("table").value.trim();
  const pk=document.getElementById("pk").value.trim();
  const sres=document.getElementById("sres").value.trim();
  const fres=document.getElementById("fres").value.trim();
  const mode=document.getElementById("mode").value;

  if(!adminTable||!adminColumn||!authFailed||!table||!pk||!sres||!fres){
    showToast("Please fill all fields!","#dc3545");
    return;
  }

  const php=`<?php
include 'config.php';

if($_SERVER['REQUEST_METHOD']!=='POST'){ echo 'Access Denied'; exit(); }

$authHeader='';
if(isset($_SERVER['HTTP_AUTHORIZATION'])) $authHeader=$_SERVER['HTTP_AUTHORIZATION'];
elseif(isset($_SERVER['REDIRECT_HTTP_AUTHORIZATION'])) $authHeader=$_SERVER['REDIRECT_HTTP_AUTHORIZATION'];
if($authHeader===''){ echo '${authFailed}'; exit(); }
if(stripos($authHeader,'bearer ')===0) $token=trim(substr($authHeader,7)); else $token=$authHeader;
if($token===''){ echo '${authFailed}'; exit(); }

$stmt=$conn->prepare("SELECT id FROM \`${adminTable}\` WHERE \`${adminColumn}\`=? LIMIT 1");
$stmt->bind_param('s',$token);
$stmt->execute();
$stmt->store_result();
if($stmt->num_rows===0){ echo '${authFailed}'; $stmt->close(); exit(); }
$stmt->close();

if(!isset($_POST['${pk}'])||trim($_POST['${pk}'])==''){ echo '${pk} is required'; exit(); }

$sql="DELETE FROM \`${table}\` WHERE \`${pk}\`=?";
$stmt=$conn->prepare($sql);
if($stmt){
  $stmt->bind_param('s', $_POST['${pk}']);
  if($stmt->execute()){
    echo '${sres}';
  } else {
    if('${mode}'==='debug'){ echo '${fres} - '.$stmt->error; } 
    else { echo '${fres}'; }
  }
  $stmt->close();
} else {
  if('${mode}'==='debug'){ echo '${fres} - '.$conn->error; } 
  else { echo '${fres}'; }
}
$conn->close();
?>`;

  document.getElementById("output").value=php;
  showToast("PHP code generated!");
}

function copyCode(){
  const txt=document.getElementById("output");
  if(!txt.value.trim()){ showToast("Nothing to copy!","#dc3545"); return; }
  navigator.clipboard.writeText(txt.value);
  showToast("Code copied!");
}
</script>





<div id="footer"></div>

<script>
fetch('permission.html')
.then(response => response.text())
.then(data => document.getElementById('footer').innerHTML = data);
</script>







</body>
</html>