<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PHP Signup Generator + Auto Table</title>
<style>
body{font-family:Arial,sans-serif;background:#fff;margin:0;padding:20px;display:flex;justify-content:center}
.container{background:#fff;padding:20px;border-radius:12px;max-width:650px;width:100%;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
h2{text-align:center;margin-bottom:20px;color:#333}
label{font-weight:bold;margin:8px 0 4px;display:block;color:#444}
input,select,textarea,button{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:16px;margin-bottom:12px;box-sizing:border-box}
input:focus,select:focus,textarea:focus{outline:none;border-color:#007bff;box-shadow:0 0 5px rgba(0,123,255,0.3)}
button{background:#007bff;border:none;color:#fff;font-weight:bold;cursor:pointer;transition:0.3s}
button:hover{background:#0056b3}
textarea{resize:none;height:350px;font-family:monospace;font-size:14px;background:#f9f9f9}
.col-row{display:flex;flex-direction:column;gap:6px;margin-bottom:15px;padding:10px;border:1px solid #ddd;border-radius:8px;background:#f9f9f9}
.checkbox-row{display:flex;align-items:center;gap:10px}
.autoTableBox{display:flex;align-items:center;gap:10px;margin:10px 0;padding:8px;background:#f8f8f8;border-radius:8px;border:1px solid #ddd}
.autoTableBox input{width:auto;transform:scale(1.3)}
#toast{display:none;min-width:200px;background:#28a745;color:#fff;text-align:center;border-radius:8px;padding:12px;position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:9999;opacity:.95;font-weight:bold}
#andOrRow{display:none;align-items:center;justify-content:center;gap:15px;margin-bottom:12px;background:#f9f9f9;padding:10px;border-radius:10px;border:1px solid #ddd;}
#andOrRow input[type="radio"]{display:none}
#andOrRow label{display:inline-block;padding:10px 18px;border-radius:8px;font-weight:bold;border:1px solid #ccc;background:#fff;cursor:pointer;transition:0.3s;user-select:none;}
#andOrRow input[type="radio"]:checked + label{background:#007bff;color:#fff;border-color:#007bff;transform:scale(1.05);}
@media (max-width:600px){#andOrRow{flex-direction:row;flex-wrap:wrap;gap:10px}#andOrRow label{flex:1;text-align:center}}
#addCol,#clearCols{padding:12px 0;border-radius:8px;font-size:16px;font-weight:bold;border:none;cursor:pointer;transition:0.3s;width:100%;box-sizing:border-box;}
#addCol{background:#007bff;color:#fff;margin-bottom:10px;}
#addCol:hover{background:#0056b3;}
#clearCols{background:#dc3545;color:#fff;margin-bottom:10px;}
#clearCols:hover{background:#a71d2a;}
@media (min-width:641px){#addCol,#clearCols{width:auto;display:inline-block;padding:10px 12px;margin-right:10px;}}
</style>
</head>
<body>
<div class="container">
<h2>PHP Signup Script Generator</h2>

<label>Table Name</label>
<input id="tableName" type="text" placeholder="Example: users">

<label>Already Exists Message</label>
<input id="existMsg" type="text" placeholder="Example: Email already exists">

<label>Signup Success Message</label>
<input id="successMsg" type="text" placeholder="Example: Signup successful">

<label>Signup Failed Message</label>
<input id="failedMsg" type="text" placeholder="Example: Signup failed">

<label>Columns</label>
<div id="cols"></div>

<button id="addCol">Add Column</button>
<button id="clearCols" style="background:red;color:white;">Clear All</button>

<div id="andOrRow">
  <input type="radio" id="orRadio" name="andOr" value="OR">
  <label for="orRadio">OR</label>
  <input type="radio" id="andRadio" name="andOr" value="AND" checked>
  <label for="andRadio">AND</label>
</div>

<div class="autoTableBox">
  <input type="checkbox" id="autoTable" checked>
  <label for="autoTable" style="margin:0;font-weight:normal;">Auto Create Table if Not Exist</label>
</div>

<button id="generate">Generate PHP</button>

<label>Preview & Result</label>
<textarea id="phpOut" readonly></textarea>
<button id="copy">Copy</button>
</div>
<div id="toast">Copied</div>

<script>
const colsEl=document.getElementById('cols')
const addColBtn=document.getElementById('addCol')
const clearColsBtn=document.getElementById('clearCols')
const generateBtn=document.getElementById('generate')
const phpOut=document.getElementById('phpOut')
const tableNameEl=document.getElementById('tableName')
const copyBtn=document.getElementById('copy')
const toast=document.getElementById('toast')
const existMsgEl=document.getElementById('existMsg')
const successMsgEl=document.getElementById('successMsg')
const failedMsgEl=document.getElementById('failedMsg')
const andOrRow=document.getElementById('andOrRow')
const autoTable=document.getElementById('autoTable')

function createColRow(name=''){
  const row=document.createElement('div');row.className='col-row'
  const nameInput=document.createElement('input');nameInput.type='text';nameInput.placeholder='Column name (e.g., email)';nameInput.value=name
  const chk=document.createElement('input');chk.type='checkbox';chk.style.width='auto';chk.onchange=updateAndOr
  const lbl=document.createElement('label');lbl.textContent='Check Exists'
  const box=document.createElement('div');box.className='checkbox-row';box.appendChild(chk);box.appendChild(lbl)
  const del=document.createElement('button');del.textContent='Delete';del.style.background='#dc3545';del.style.marginTop='6px';del.onclick=()=>{row.remove();updateAndOr()}
  row.appendChild(nameInput);row.appendChild(box);row.appendChild(del)
  colsEl.appendChild(row)
}

function updateAndOr(){
  const checkedCount=Array.from(colsEl.querySelectorAll('.col-row input[type=checkbox]')).filter(c=>c.checked).length
  andOrRow.style.display=checkedCount>1?'flex':'none'
}

addColBtn.addEventListener('click',()=>createColRow())
clearColsBtn.addEventListener('click',()=>{colsEl.innerHTML='';updateAndOr()})

function buildPHP(){
  const table=tableNameEl.value.trim()||'users'
  const existMsg=existMsgEl.value.trim()||'Record already exists'
  const successMsg=successMsgEl.value.trim()||'Signup successful'
  const failedMsg=failedMsgEl.value.trim()||'Signup failed'
  const andOr=document.querySelector('input[name="andOr"]:checked')?.value||'OR'
  const rows=Array.from(colsEl.querySelectorAll('.col-row'))
  const cols=[];const checks=[]
  for(const r of rows){
    const name=r.querySelector('input[type=text]').value.trim()
    const chk=r.querySelector('input[type=checkbox]').checked
    if(!name) continue
    cols.push(name)
    if(chk) checks.push(name)
  }
  if(!cols.length) return 'Please add at least one column.'

  // fields
  let fields=cols.map(c=>`$${c} = isset($_POST['${c}']) ? trim($_POST['${c}']) : '';`).join('\n    ')

  // empty check (strict)
  let emptyCheck=`foreach(array(${cols.map(c=>`$${c}`).join(', ')}) as $v){ if($v === ''){ echo "All fields are required"; exit; } }`

  let where='',bindParams='',bindVars='',checkSection=''
  if(checks.length>0){
    where=' WHERE '+checks.map(c=>`${c} = ?`).join(' '+andOr+' ')
    bindParams=checks.map(_=>'s').join('')
    bindVars=checks.map(c=>`$${c}`).join(', ')
    checkSection=`$check = $conn->prepare("SELECT * FROM ${table}${where}");
    $check->bind_param("${bindParams}", ${bindVars});
    $check->execute();
    $result = $check->get_result();
    if ($result->num_rows > 0) {
        echo "${existMsg}";
        exit;
    }`
  }

  let insertCols=cols.join(', ')
  let qMarks=cols.map(_=>'?').join(', ')
  let bindInsertTypes=cols.map(_=>'s').join('')
  let bindInsertVars=cols.map(c=>`$${c}`).join(', ')

  let autoTableCode=''
  if(autoTable.checked){
    autoTableCode=`$checkTable = $conn->query("SHOW TABLES LIKE '${table}'");
if ($checkTable->num_rows == 0) {
    $create = "CREATE TABLE ${table} (id INT AUTO_INCREMENT PRIMARY KEY${cols.map(c=>`, ${c} TEXT`).join('')})";
    $conn->query($create);
} else {
    $existingCols = [];
    $res = $conn->query("SHOW COLUMNS FROM ${table}");
    while ($r = $res->fetch_assoc()) { $existingCols[] = $r['Field']; }
    foreach (array(${cols.map(c=>`'${c}'`).join(', ')}) as $col) {
        if (!in_array($col, $existingCols)) {
            $conn->query("ALTER TABLE ${table} ADD \`$col\` TEXT");
        }
    }
}

`
  }

  return `<?php
include 'config.php';
if ($_SERVER['REQUEST_METHOD'] === 'POST') {

    ${autoTableCode}${fields}

    ${emptyCheck}

    ${checkSection}

    $stmt = $conn->prepare("INSERT INTO ${table} (${insertCols}) VALUES (${qMarks})");
    $stmt->bind_param("${bindInsertTypes}", ${bindInsertVars});

    if ($stmt->execute()) {
        echo "${successMsg}";
    } else {
        echo "${failedMsg}";
    }

    $stmt->close();
    $conn->close();
} else {
    echo "Invalid request";
}
?>`
}

generateBtn.addEventListener('click',()=>{phpOut.value=buildPHP()})
copyBtn.addEventListener('click',async()=>{
  const txt=phpOut.value;if(!txt)return alert('Nothing to copy — generate first.');
  try{await navigator.clipboard.writeText(txt);
  toast.style.display='block';setTimeout(()=>toast.style.display='none',2000)}
  catch(e){alert('Copy failed — browser not supported.')}
})
phpOut.value=''
</script>
</body>
  </html>
